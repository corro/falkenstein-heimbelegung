<?php/** * Belegung View für das Heimbelegungs Component *  * @package    Falkenstein.Joomla * @subpackage Components * @link       http://www.pfadi-falkenstein.ch * @license		GNU/GPL */// Import der Basisklassejimport( 'joomla.application.component.view');/** * Viewklasse für die Belegungsübersicht * * @package		Falkenstein.Joomla * @subpackage	Components */class BelegungViewBelegung extends JView{    function display($tpl = null)    {        $heim     = JRequest::getVar('heim', 'buschi');        $month    = JRequest::getInt('month', date('n'));        $year     = JRequest::getInt('year', date('Y'));                $start_data = array($year, $month, 01);        $start_date = join('-', $start_data);                $last_day = date('t', $start_date);        $stop_data = array($year, $month, $last_day);        $stop_date = join('-', $stop_data);                // Daten laden        $model = $this->getModel();        $belegung = $model->getBelegung($heim, $start_date, $stop_date);        $last_mod = $model->getLastModified();                // Als besetzt zu markierende Tage errechnen        $days = array();        foreach ($belegung as $b)        {            $von = strtotime($b->von);            $first = gmmktime(0,0,0,$month,1,$year);                        $bis = strtotime($b->bis);            $last = gmmktime(0,0,0,$month,gmdate('t', $first),$year);                        if ($von < $first) $von = $first;            if ($bis > $last) $bis = $last;            $day_von   = date('j', $von);            $day_bis   = date('j', $bis);            $day_count = $day_bis - $day_von;                        for ($i = 0; $i <= $day_count; $i++)            {                $day = $day_von + $i;                if ($i == 0) $days[$day] = $b->vonTageszeit;                else if ($i == $day_count) $days[$day] = $b->bisTageszeit;                else $days[$day] = 'B';            }        }        // Angaben für die Links zum letzten/nächsten Monat        // -> Nicht korrekte Angaben werden automatisch korrigiert 01.13.2010 -> 01.01.2011        $next = gmmktime(0,0,0,$month + 1,1,$year);        $prev = gmmktime(0,0,0,$month - 1,1,$year);        // Inhalt für das Template definieren        $this->assignRef('month', $month);        $this->assignRef('year', $year);        $this->assignRef('days', $days);        $this->assignRef('next', $next);        $this->assignRef('prev', $prev);        $this->assignRef('heim', $heim);        $this->assignRef('last_mod', $last_mod);        // Browsertitel anpassen        $document = JFactory::getDocument();        $document->setTitle('Heimbelegung');        $document->addStyleSheet('components/com_heimbelegung/css/calendar-style.css');                if (gmmktime(0,0,0,$month,$last_day,$year) < time())        {            $app =& JFactory::getApplication();            $app->enqueueMessage('Der betrachtete Monat liegt in der Vergangenheit', 'warning');        }        parent::display($tpl);    }}